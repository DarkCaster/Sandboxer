#!/bin/bash

#find place for xpra ipc-file

#detect temp directory, located on tmpfs
for xpra_ipc_test in "$TMPDIR" "/tmp" "$XDG_RUNTIME_DIR"
do
  [[ -z "$xpra_ipc_test" || ! -d $xpra_ipc_test || -z `2>/dev/null df -P -t tmpfs "$xpra_ipc_test"` ]] && continue
  xpra_ipc_dir="$xpra_ipc_test"
  break
done

if [[ ! -z $xpra_ipc_dir ]]; then
  xpra_ipc_dir="$xpra_ipc_dir/xpra_ipc"
  mkdir -p "$xpra_ipc_dir"
  echo "$xpra_ipc_dir" > "$basedir/xpra_ipc_dir"
  sandbox_bind_rw "$xpra_ipc_dir" "/xpra_ipc"
fi
